<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The Root</title>
  <link rel="icon" type="image/png" href="images/summer.png" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <script>
    (function(){
      try {
        if (sessionStorage.getItem('root_intro_seen')) {
          document.documentElement.classList.add('intro-seen');
        }
      } catch (_) {}
    })();
  </script>

  <style>
    :root{
      /* =========================
         INTRO (keep the same)
         ========================= */
      --bg:#1E2320;
      --text:#EDEBE6;

      /* =========================
         APP THEME (reference style)
         ========================= */
      --app-bg: #231815;
      --app-ink:#efe4d3;
      --app-muted: rgba(232,210,184,0.75);
      --app-muted-2: rgba(232,210,184,0.55);

      --gold-3:#e1c28a;
      --bronze-1:#a77a4d;
      --bronze-2:#7b5637;

      --shadow: 0 14px 36px rgba(0,0,0,0.55);
      --radius: 18px;
      --radius-sm: 14px;
      --max: 1040px;
    }

    *{ box-sizing:border-box; }
    html,body{ min-height:100%; }
    html{
      background-color: #1a130f;
      background:
        radial-gradient(900px 700px at 30% 10%, rgba(146,106,70,0.20), transparent 60%),
        radial-gradient(900px 700px at 90% 40%, rgba(98,69,46,0.18), transparent 60%),
        radial-gradient(1100px 900px at 50% 120%, rgba(0,0,0,0.55), transparent 55%),
        linear-gradient(180deg, #1a130f, var(--app-bg));
      background-attachment: fixed;
    }

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color: var(--app-ink);
      line-height: 1.35;
      overflow-y: auto;
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* IE/Edge legacy */
      background-color: #1a130f;
      background: transparent;
    }
    body::-webkit-scrollbar{ width:0; height:0; }

    .legalBanner{
      position: relative;
      padding-right: 34px;
    }
    .legalDismiss{
      position: absolute;
      top: 6px;
      right: 8px;
      width: 18px;
      height: 18px;
      border: 1px solid rgba(167,122,77,0.45);
      border-radius: 999px;
      background: rgba(24,16,12,0.88);
      color: rgba(232,210,184,0.9);
      font-size: 12px;
      line-height: 1;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      padding: 0;
    }
    .legalDismiss:hover,
    .legalDismiss:focus-visible{
      border-color: rgba(225,194,138,0.78);
      color: rgba(245,227,198,0.98);
      background: rgba(40,26,18,0.92);
    }
    .legalBanner.isDismissed{
      display: none;
    }

    a{ color:inherit; text-decoration:none; }
    .wrap{
      max-width: var(--max);
      margin: 0 auto;
      padding: 0 18px 56px;
    }
    .headerStack{
      position: sticky;
      top: 16px;
      z-index: 20;
    }
    .legalBanner{
      margin-top: 0;
      margin-bottom: 8px;
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid rgba(167,122,77,0.35);
      background: rgba(20,13,10,0.72);
      color: rgba(232,210,184,0.86);
      font-size: 12px;
      line-height: 1.4;
      text-align: center;
    }
    .legalBanner a{
      color: var(--gold-3);
      font-weight: 700;
      text-decoration: underline;
      text-underline-offset: 2px;
    }

    .deployBanner{
      margin-bottom: 8px;
      padding: 8px 12px 10px;
      border-radius: 10px;
      border: 1px solid rgba(90,155,110,0.45);
      background: linear-gradient(180deg, rgba(18,40,24,0.78), rgba(11,28,17,0.86));
      box-shadow: inset 0 1px 0 rgba(184,236,198,0.09);
    }
    .deployHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 8px;
      margin-bottom: 6px;
      font-size: 12px;
      line-height: 1.2;
    }
    .deployTitle{
      color: rgba(198,238,208,0.95);
      font-weight: 700;
      letter-spacing: 0.2px;
    }
    .deployState{
      color: rgba(160,229,180,0.9);
      font-weight: 700;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .deployTrack{
      position: relative;
      height: 8px;
      border-radius: 999px;
      border: 1px solid rgba(140,208,158,0.5);
      background: rgba(8,18,12,0.72);
      overflow: visible;
    }
    .deployFill{
      position:absolute;
      left:0;
      top:0;
      bottom:0;
      width: 10%;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(111,224,146,0.88), rgba(56,174,105,0.92));
      box-shadow: 0 0 10px rgba(94,210,130,0.45);
    }
    .deployMark{
      position:absolute;
      left: 70%;
      top: -3px;
      bottom: -3px;
      width: 2px;
      background: rgba(195,247,210,0.96);
      box-shadow: 0 0 8px rgba(126,232,162,0.6);
    }
    .deployMarkLabel{
      position: absolute;
      left: 70%;
      bottom: calc(100% + 2px);
      transform: translateX(-50%);
      font-size: 10px;
      font-weight: 700;
      color: rgba(190,244,206,0.95);
      letter-spacing: 0.2px;
      white-space: nowrap;
      line-height: 1;
    }

    /* =========================
       INTRO (unchanged)
       ========================= */
    .intro{
      position: fixed;
      inset: 0;
      background: var(--bg);
      color: var(--text);
      display: grid;
      place-items: center;
      z-index: 9999;
      opacity: 1;
      transition: opacity 1800ms ease, visibility 0ms linear 1800ms;
      visibility: visible;
    }
    .intro.hide{ opacity:0; visibility:hidden; }
    .intro-seen .intro{ display:none !important; }

    .introStage{
      width: min(920px, 92vw);
      display: grid;
      place-items: center;
      row-gap: 14px;
      text-align: center;
    }
    .jp{
      font-family: "Hiragino Mincho ProN","Yu Mincho","Noto Serif JP","MS Mincho",serif;
      letter-spacing: 0.02em;
    }
    .introTree{
      width: clamp(120px, 18vw, 190px);
      opacity: 0;
      transform: translateY(6px);
      transition: opacity 1800ms ease, transform 1800ms ease;
      filter: drop-shadow(0 14px 26px rgba(0,0,0,0.45));
      user-select: none;
      -webkit-user-drag: none;
    }
    .introLine1{
      font-size: clamp(28px, 4vw, 56px);
      font-weight: 600;
      margin: 0;
      opacity: 0;
      transition: opacity 1800ms ease;
      text-shadow: 0 10px 28px rgba(0,0,0,0.45);
    }
    .introLine2{
      font-size: clamp(16px, 2.1vw, 22px);
      font-weight: 500;
      margin: 0;
      opacity: 0;
      transition: opacity 1800ms ease;
      color: rgba(237,235,230,0.85);
      text-shadow: 0 10px 28px rgba(0,0,0,0.45);
    }
    .show{ opacity:1 !important; }
    .showTree{ opacity:1 !important; transform: translateY(0) !important; }

    @media (prefers-reduced-motion: reduce){
      .intro, .introTree, .introLine1, .introLine2{ transition:none !important; }
    }

    /* =========================
       Top Bar
       ========================= */
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      margin-top: 0;
      margin-bottom: 36px;
      padding: 0 12px;
      border-radius: var(--radius);
      border: 1px solid rgba(167,122,77,0.35);
      background:
        linear-gradient(180deg, rgba(109,78,49,0.25), rgba(14,9,7,0.65)),
        radial-gradient(900px 240px at 40% 0%, rgba(167,122,77,0.22), transparent 60%),
        rgba(18,12,9,0.55);
      box-shadow: var(--shadow);
      position: relative;
      top: 0;
      z-index: 1;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .left{
      display:flex;
      align-items:center;
      gap:16px;
      min-width: 220px;
    }

    .userBadge{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 2px 8px 2px 2px;
      border-radius: 999px;
    }

    .avatar{
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display:grid;
      place-items:center;
      background:
        radial-gradient(60% 60% at 40% 35%, rgba(231,210,170,0.18), transparent 70%),
        linear-gradient(160deg, rgba(36,29,26,0.9), rgba(10,7,6,0.9));
      border: 1px solid rgba(239,230,214,0.2);
    }

    .avatar svg{
      width: 22px;
      height: 22px;
      opacity: 0.85;
      fill: var(--app-ink);
    }

    .userMeta{
      display:flex;
      flex-direction:column;
      line-height: 1.1;
    }

    .userName{
      font-size: 14px;
      font-weight: 700;
      color: var(--gold-3);
      letter-spacing: 0.2px;
    }

    .userAddr{
      font-size: 12px;
      color: var(--app-muted);
      font-variant-numeric: tabular-nums;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:14px;
    }

    /* Bigger icon, NO square around it */
    .logo{
      width: 108px;
      height: 108px;
      object-fit: contain;
      border: none;
      border-radius: 0;
      background: transparent;
      box-shadow: none;
      filter: drop-shadow(0 12px 20px rgba(0,0,0,0.45));
      -webkit-user-drag: none;
      user-select:none;
    }

    .brandTitle h1{
      margin:0;
      font-family: "Georgia", "Times New Roman", serif;
      font-weight: 800;
      letter-spacing: 0.2px;
      font-size: 30px;
      color: var(--gold-3);
      text-shadow: 0 10px 26px rgba(0,0,0,0.55);
      line-height: 1;
      white-space: normal;
    }

    .right{
      display:flex;
      align-items:center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content:flex-end;
    }

    .profileMenu{
      position: relative;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .profileNotify{
      position: absolute;
      top: -6px;
      right: -6px;
      width: 20px;
      height: 20px;
      border-radius: 999px;
      border: 1px solid rgba(225,194,138,0.75);
      background: rgba(148,39,39,0.95);
      color: #fbe9c6;
      display:grid;
      place-items:center;
      box-shadow: 0 8px 16px rgba(0,0,0,0.45);
      z-index: 24;
      pointer-events: auto;
      cursor: help;
    }
    .profileNotify svg{
      width: 11px;
      height: 11px;
      fill: currentColor;
    }
    .profileNotifyTip{
      position: absolute;
      right: 0;
      bottom: calc(100% + 8px);
      display: none;
      min-width: 190px;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid rgba(167,122,77,0.35);
      background: rgba(18,12,9,0.96);
      color: rgba(232,210,184,0.92);
      font-size: 12px;
      font-weight: 600;
      text-align: center;
      box-shadow: 0 10px 20px rgba(0,0,0,0.45);
      z-index: 26;
      pointer-events: none;
    }
    .profileNotify:hover + .profileNotifyTip,
    .profileNotify:focus-visible + .profileNotifyTip{
      display:block;
    }

    .profileBtn{
      display:flex;
      align-items:center;
      gap:8px;
      padding: 4px;
      border-radius: 999px;
      border: 1px solid rgba(239,230,214,0.14);
      background: rgba(10,7,6,0.45);
      box-shadow: 0 10px 24px rgba(0,0,0,0.35);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      cursor: pointer;
      transition: 160ms ease;
    }

    .profileBtn:hover,
    .profileBtn:focus-visible{
      border-color: rgba(231,210,170,0.45);
      background: rgba(18,12,10,0.7);
      box-shadow: 0 12px 28px rgba(0,0,0,0.45);
      transform: translateY(-1px);
    }

    .profilePanel{
      position: absolute;
      right: 0;
      top: calc(100% + 8px);
      min-width: 220px;
      padding: 10px;
      border-radius: 14px;
      border: 1px solid rgba(239,230,214,0.14);
      background: rgba(10,7,6,0.75);
      box-shadow: 0 14px 28px rgba(0,0,0,0.45);
      display:none;
      z-index: 20;
    }

    .profileBtn:hover ~ .profilePanel,
    .profileBtn:focus-visible ~ .profilePanel,
    .profilePanel:hover,
    .profileMenu:focus-within .profilePanel{
      display:block;
    }

    .profilePanel .pill{
      background: transparent;
      border: none;
      padding: 6px 0;
      border-radius: 0;
      box-shadow: none;
    }

    .tabs{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(167,122,77,0.35);
      background: rgba(20,13,10,0.55);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.04),
        inset 0 -1px 0 rgba(0,0,0,0.6);
    }
    .tab{
      position: relative;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid transparent;
      background: transparent;
      color: rgba(232,210,184,0.8);
      font-family: "Georgia","Times New Roman",serif;
      font-weight: 650;
      letter-spacing: 0.2px;
      cursor: pointer;
      user-select: none;
      transition: 140ms ease;
    }
    .tab:hover{
      color: var(--gold-3);
      background: rgba(86,60,38,0.45);
      border-color: rgba(193,143,95,0.45);
    }
    .tab.active{
      color: var(--gold-3);
      background: rgba(104,73,45,0.65);
      border-color: rgba(209,164,110,0.6);
    }
    .tab.active::after{
      content:"";
      position:absolute;
      left: 14px;
      right: 14px;
      bottom: -8px;
      height: 2px;
      background: linear-gradient(90deg, transparent, rgba(225,194,138,0.95), transparent);
      box-shadow: 0 0 16px rgba(225,194,138,0.55);
      border-radius: 999px;
    }

    .profile{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(203,180,138,0.22);
      background: rgba(0,0,0,0.18);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.05);
      white-space: nowrap;
    }
    .profile .pill{
      white-space: nowrap;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(203,180,138,0.18);
      background: rgba(203,180,138,0.08);
      font-size: 12px;
      color: rgba(239,230,214,0.78);
      font-family: ui-sans-serif, system-ui;
    }
    .profile .value{
      font-size: 13px;
      font-weight: 800;
      color: var(--gold-3);
      margin-left: 6px;
      letter-spacing: 0.2px;
    }

    /* =========================
       Sub-tabs header inside pages
       ========================= */
    .page{ margin-top: 18px; display:none; }
    .page.active{ display:block; }

    .subTabs{
      margin-top: 14px;
      padding: 10px 12px;
      border-radius: var(--radius);
      border: 1px solid rgba(239,230,214,0.12);
      background:
        linear-gradient(180deg, rgba(231,210,170,0.08), rgba(0,0,0,0.20)),
        rgba(0,0,0,0.16);
      box-shadow: 0 18px 40px rgba(0,0,0,0.45);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
    }

    .subTabRow{
      display:flex;
      align-items:center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .subTab{
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid transparent;
      background: transparent;
      color: rgba(239,230,214,0.72);
      font-family: "Georgia","Times New Roman",serif;
      font-weight: 650;
      letter-spacing: 0.2px;
      cursor: pointer;
      position: relative;
      transition: 140ms ease;
      user-select:none;
    }
    .subTab:hover{
      background: rgba(203,180,138,0.08);
      border-color: rgba(203,180,138,0.18);
      color: var(--gold-3);
    }
    .subTab.active{
      color: var(--gold-3);
      background: rgba(203,180,138,0.10);
      border-color: rgba(203,180,138,0.24);
    }
    .subTab.active::after{
      content:"";
      position:absolute;
      left: 14px;
      right: 14px;
      bottom: -8px;
      height: 2px;
      background: linear-gradient(90deg, transparent, rgba(231,210,170,0.95), transparent);
      box-shadow: 0 0 16px rgba(231,210,170,0.55);
      border-radius: 999px;
    }

    .filterBtn{
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(203,180,138,0.22);
      background: rgba(0,0,0,0.20);
      color: rgba(239,230,214,0.85);
      font-family: ui-sans-serif, system-ui;
      font-weight: 650;
      cursor: pointer;
      transition: 140ms ease;
      white-space: nowrap;
    }
    .filterBtn:hover{
      transform: translateY(-1px);
      border-color: rgba(231,210,170,0.28);
      background: rgba(203,180,138,0.08);
    }

    /* Controls (search) */
    .controls{
      margin-top: 14px;
      display:flex;
      gap: 12px;
      align-items:center;
      flex-wrap: wrap;
    }
    .search{
      flex: 1 1 520px;
      display:flex;
      align-items:center;
      gap:10px;
      padding: 12px 14px;
      border-radius: 999px;
      border: 1px solid rgba(203,180,138,0.22);
      background: rgba(0,0,0,0.22);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.05);
    }
    .search svg{ flex: 0 0 auto; opacity: 0.9; color: rgba(239,230,214,0.75); }
    .search input{
      width:100%;
      border:0;
      outline:0;
      background: transparent;
      color: var(--app-ink);
      font-size: 15px;
    }
    .tinyPill{
      flex: 0 0 auto;
      padding: 10px 12px;
      border: 1px solid rgba(167,122,77,0.35);
      background: rgba(20,13,10,0.55);
      border-radius: 999px;
      color: rgba(232,210,184,0.78);
      font-size: 13px;
      white-space: nowrap;
    }
    .sortControl{
      flex: 0 0 auto;
      min-width: 220px;
      padding: 10px 34px 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(167,122,77,0.35);
      background: rgba(20,13,10,0.55);
      color: rgba(232,210,184,0.9);
      font-size: 13px;
      font-family: ui-sans-serif, system-ui;
      font-weight: 650;
      outline: none;
      cursor: pointer;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23e1c28a' stroke-width='1.8' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 20px center;
    }

    /* Cards (reference layout) */
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
      margin-top: 14px;
    }
    .card{
      display:grid;
      grid-template-columns: 260px 1fr 160px;
      gap: 16px;
      padding: 14px;
      border-radius: var(--radius);
      border: 1px solid rgba(167,122,77,0.35);
      background:
        linear-gradient(180deg, rgba(120,86,56,0.22), rgba(10,7,5,0.55)),
        rgba(20,13,10,0.55);
      box-shadow: 0 18px 40px rgba(0,0,0,0.50);
      position: relative;
      overflow: visible;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background: radial-gradient(700px 220px at 15% 0%, rgba(171,125,79,0.22), transparent 55%);
      pointer-events:none;
    }

    .thumbWrap{
      position: relative;
      border-radius: var(--radius-sm);
      border: 1px solid rgba(203,180,138,0.22);
      overflow:hidden;
      background: rgba(0,0,0,0.25);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.05);
    }
    .thumb{
      width:100%;
      height: 150px;
      object-fit: cover;
      display:block;
      filter: saturate(0.95) contrast(1.05);
    }
    .thumbMockTag{
      position: absolute;
      left: 6px;
      right: 6px;
      bottom: 6px;
      padding: 3px 6px;
      border-radius: 6px;
      border: 1px solid rgba(167,122,77,0.3);
      background: rgba(15,10,8,0.72);
      color: rgba(232,210,184,0.88);
      font-size: 10px;
      line-height: 1.2;
      text-align: center;
      z-index: 2;
      pointer-events: none;
    }

    .cardMain{
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap: 8px;
      position: relative;
      z-index: 1;
    }
    .title{
      margin:0;
      font-family: "Georgia","Times New Roman",serif;
      font-size: 30px;
      font-weight: 700;
      color: var(--gold-3);
      letter-spacing: 0.2px;
      text-shadow: 0 14px 30px rgba(0,0,0,0.55);
      line-height: 1.05;
    }
    .rev{
      font-family: ui-sans-serif, system-ui;
      font-weight: 800;
      font-size: 18px;
      color: rgba(239,230,214,0.92);
    }
    .rev .unit{
      font-weight: 700;
      color: rgba(239,230,214,0.65);
      font-size: 14px;
      margin-left: 6px;
    }

    .rowStats{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px 14px;
      margin-top: 6px;
      padding-top: 10px;
      border-top: 1px solid rgba(203,180,138,0.18);
      color: rgba(239,230,214,0.78);
      font-size: 13px;
    }
    .rowStats .k{ color: rgba(239,230,214,0.62); margin-right: 10px; }
    .rowStats .v{ color: rgba(239,230,214,0.92); font-weight: 750; letter-spacing: 0.2px; }

    .cardAction{
      display:flex;
      align-items:center;
      justify-content:center;
      position: relative;
      z-index: 1;
    }
    .viewBtn{
      width: 140px;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid rgba(203,180,138,0.35);
      background: linear-gradient(180deg, rgba(239,230,214,0.78), rgba(203,180,138,0.70));
      color: #2a1d16;
      font-family: "Georgia","Times New Roman",serif;
      font-weight: 800;
      cursor: pointer;
      box-shadow: 0 14px 28px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.5);
      transition: 140ms ease;
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
    }
    .viewBtn:hover{ transform: translateY(-1px); }
    .cloneBtnUnavailable{
      position: relative;
      background: transparent;
      color: rgba(232,210,184,0.9);
      border: 1px solid rgba(203,180,138,0.45);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.08);
      cursor: not-allowed;
    }
    .cloneBtnUnavailable:hover{
      transform: none;
      background: rgba(20,13,10,0.45);
      border-color: rgba(231,210,170,0.6);
    }
    .cloneBtnUnavailable:hover::after{
      content: attr(data-tip);
      position: absolute;
      left: 50%;
      bottom: calc(100% + 8px);
      transform: translateX(-50%);
      min-width: 260px;
      max-width: min(320px, calc(100vw - 40px));
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid rgba(167,122,77,0.35);
      background: rgba(18,12,9,0.95);
      color: rgba(232,210,184,0.92);
      font-size: 12px;
      font-weight: 600;
      font-family: ui-sans-serif, system-ui;
      line-height: 1.35;
      text-align: center;
      white-space: normal;
      box-shadow: 0 10px 20px rgba(0,0,0,0.45);
      z-index: 25;
      pointer-events: none;
    }

    /* Map panel */
    .mapPanel{
      margin-top: 14px;
      border-radius: var(--radius);
      border: 1px solid rgba(167,122,77,0.35);
      overflow: hidden;
      background: rgba(20,13,10,0.6);
      box-shadow: 0 18px 40px rgba(0,0,0,0.55);
    }
    .mapHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 12px 14px;
      background: linear-gradient(180deg, rgba(120,86,56,0.24), rgba(10,7,5,0.55));
      border-bottom: 1px solid rgba(167,122,77,0.28);
      color: rgba(232,210,184,0.8);
      font-size: 13px;
    }
    .badge{
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(167,122,77,0.35);
      background: rgba(24,16,12,0.6);
      color: var(--gold-3);
      font-weight: 800;
      font-size: 12px;
      font-family: ui-sans-serif, system-ui;
      letter-spacing: 0.2px;
    }
    .mapFrame,
    #map{
      width: 100%;
      height: min(520px, 65vh);
      border: 0;
      display: block;
      filter: saturate(0.95) contrast(1.05);
    }
    .leaflet-container{
      background: #14100d;
    }

    /* Manage: single business page */
    .businessPage{
      margin-top: 14px;
      border-radius: var(--radius);
      border: 1px solid rgba(167,122,77,0.35);
      background: linear-gradient(180deg, rgba(120,86,56,0.22), rgba(10,7,5,0.55)), rgba(20,13,10,0.55);
      box-shadow: 0 18px 40px rgba(0,0,0,0.55);
      overflow:hidden;
    }
    .businessHero{
      display:grid;
      grid-template-columns: 1.3fr 1fr;
      gap: 14px;
      padding: 14px;
      border-bottom: 1px solid rgba(167,122,77,0.28);
    }
    .heroImg{
      border-radius: var(--radius-sm);
      border: 1px solid rgba(167,122,77,0.35);
      overflow:hidden;
      background: rgba(18,12,9,0.6);
      aspect-ratio: 4 / 3;
    }
    .heroImg img{
      width:100%;
      height: 100%;
      object-fit: cover;
      object-position: center 20%;
      display:block;
      filter: none;
    }
    .heroInfo{
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap: 10px;
      padding: 4px 2px;
    }
    .heroInfo h2{
      margin:0;
      font-family: "Georgia","Times New Roman",serif;
      font-size: 42px;
      color: var(--gold-3);
      text-shadow: 0 16px 34px rgba(0,0,0,0.55);
      line-height: 1.05;
    }
    .heroMeta{
      color: rgba(232,210,184,0.8);
      font-size: 14px;
    }
    .heroBadges{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 2px;
    }
    .teamList{
      margin-top: 10px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 8px 10px;
    }
    .teamTitle{
      margin-top: 12px;
      font-size: 12px;
      letter-spacing: 0.3px;
      text-transform: uppercase;
      color: rgba(232,210,184,0.65);
      font-weight: 700;
    }
    .branches{
      margin-top: 14px;
      margin-left: 14px;
      margin-right: 14px;
      padding: 14px 24px;
      border-radius: var(--radius-sm);
      border: 1px solid rgba(203,180,138,0.18);
      background: rgba(0,0,0,0.18);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.04);
    }
    .branchesTitle{
      margin: 0 0 10px;
      font-size: 12px;
      color: rgba(232,210,184,0.7);
      text-transform: uppercase;
      letter-spacing: 0.4px;
      font-weight: 700;
    }
    .branchList{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
      padding: 0;
    }
    .branchItem{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid rgba(167,122,77,0.22);
      background: rgba(18,12,9,0.55);
      color: rgba(232,210,184,0.85);
      font-size: 12px;
      font-variant-numeric: tabular-nums;
    }
    .branchLeft{
      display:flex;
      align-items:center;
      gap: 8px;
      min-width: 0;
      overflow: hidden;
    }
    .storeIcon{
      width: 18px;
      height: 18px;
      border-radius: 6px;
      display:grid;
      place-items:center;
      background: rgba(18,12,9,0.7);
      border: 1px solid rgba(231,210,170,0.35);
      flex: 0 0 auto;
    }
    .storeIcon svg{
      width: 12px;
      height: 12px;
      fill: var(--gold-3);
      opacity: 0.85;
    }
    .branchAddr{
      white-space: nowrap;
    }
    .branchRoyalty{
      color: var(--gold-3);
      font-weight: 700;
      min-width: 44px;
      text-align: right;
    }
    .branchRequests{
      margin-top: 12px;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid rgba(167,122,77,0.28);
      background: rgba(18,12,9,0.55);
      position: relative;
      z-index: 3;
    }
    .branchReqHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      color: rgba(232,210,184,0.9);
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }
    .branchReqCount{
      min-width: 44px;
      height: 24px;
      padding: 0 9px;
      border-radius: 999px;
      border: 1px solid rgba(245,206,143,0.75);
      background: radial-gradient(circle at 30% 30%, rgba(250,126,126,0.95), rgba(146,30,30,0.95));
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap: 5px;
      color: #fff1d5;
      font-size: 12px;
      font-weight: 900;
      box-shadow: 0 0 0 2px rgba(18,12,9,0.5), 0 8px 16px rgba(0,0,0,0.45);
    }
    .branchReqCount.isZero{
      border-color: rgba(167,122,77,0.45);
      background: rgba(34,23,17,0.85);
      color: rgba(232,210,184,0.82);
      box-shadow: 0 0 0 1px rgba(18,12,9,0.35);
    }
    .branchReqCount svg{
      width: 10px;
      height: 10px;
      fill: currentColor;
      opacity: 0.95;
    }
    .branchReqRule{
      margin: 8px 0 0;
      color: rgba(232,210,184,0.75);
      font-size: 12px;
    }
    .branchReqList{
      position: absolute;
      left: 0;
      right: 0;
      top: 100%;
      margin-top: 0;
      display:none;
      gap: 6px;
      flex-direction: column;
      z-index: 35;
      pointer-events: auto;
      padding: 8px;
      border-radius: 10px;
      border: 1px solid rgba(167,122,77,0.34);
      background: rgba(14,9,7,0.96);
      box-shadow: 0 12px 24px rgba(0,0,0,0.5);
    }
    .branchRequests:hover .branchReqList,
    .branchReqList:hover{
      display:flex;
    }
    .branchReqItem{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 7px 8px;
      border-radius: 8px;
      border: 1px solid rgba(167,122,77,0.24);
      background: rgba(20,13,10,0.92);
      color: rgba(232,210,184,0.85);
      font-size: 12px;
      font-variant-numeric: tabular-nums;
    }
    .branchReqPct{
      color: var(--gold-3);
      font-weight: 700;
    }
    .branchReqMeta{
      display:flex;
      align-items:center;
      gap: 8px;
    }
    .branchAcceptBtn{
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(167,122,77,0.32);
      background: rgba(20,13,10,0.45);
      color: rgba(232,210,184,0.68);
      font-size: 11px;
      font-weight: 700;
      cursor: pointer;
      opacity: 0.92;
      transition: 140ms ease;
    }
    .branchAcceptBtn:hover,
    .branchAcceptBtn:focus-visible{
      border-color: rgba(225,194,138,0.72);
      background: rgba(48,31,22,0.82);
      color: rgba(244,229,201,0.98);
    }
    .branchAcceptBtn:disabled{
      cursor: not-allowed;
      opacity: 0.6;
      pointer-events: none;
    }
    .branchReqEmpty{
      justify-content: center;
      color: rgba(232,210,184,0.7);
      font-style: italic;
    }
    .teamMember{
      display:grid;
      align-items:center;
      grid-template-columns: auto 1fr auto;
      column-gap: 10px;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid rgba(167,122,77,0.28);
      background: rgba(20,13,10,0.55);
      color: rgba(232,210,184,0.85);
      font-size: 12px;
      font-variant-numeric: tabular-nums;
    }
    .teamMember.highlight{
      border-color: rgba(225,194,138,0.75);
      box-shadow: 0 0 0 1px rgba(225,194,138,0.25);
    }
    .teamInfo{
      display:flex;
      align-items:center;
      gap:8px;
      min-width: 0;
      overflow: hidden;
    }
    .teamInfo span:last-child{
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .teamPct{
      color: var(--gold-3);
      font-weight: 700;
      letter-spacing: 0.2px;
      min-width: 44px;
      text-align: right;
      justify-self: end;
    }
    .anonIcon{
      width: 18px;
      height: 18px;
      border-radius: 50%;
      display:grid;
      place-items:center;
      background: rgba(18,12,9,0.7);
      border: 1px solid rgba(231,210,170,0.35);
      flex: 0 0 auto;
      position: relative;
      overflow: visible;
    }
    .anonIcon svg{
      width: 12px;
      height: 12px;
      fill: var(--gold-3);
      opacity: 0.85;
    }
    .teamMember.highlight{
      position: relative;
    }
    .teamMember.highlight::after{
      content:"";
      position:absolute;
      top: -8px;
      right: -8px;
      width: 16px;
      height: 16px;
      background: rgba(225,194,138,0.98);
      border: 1px solid rgba(42,27,18,0.85);
      border-radius: 6px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.55);
      z-index: 3;
      pointer-events: none;
    }
    .teamMember.highlight::before{
      content:"";
      position:absolute;
      top: -4px;
      right: -4px;
      width: 10px;
      height: 10px;
      z-index: 4;
      background: #2a1b12;
      -webkit-mask: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path d='M3 18h18l-2-10-5 5-2-7-2 7-5-5-2 10Zm4 2h10v2H7v-2Z'/></svg>") no-repeat center / contain;
      mask: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path d='M3 18h18l-2-10-5 5-2-7-2 7-5-5-2 10Zm4 2h10v2H7v-2Z'/></svg>") no-repeat center / contain;
      pointer-events: none;
    }

    .heroStats{
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap: 12px;
      padding: 14px;
    }
    .stat{
      padding: 12px 12px;
      border-radius: var(--radius-sm);
      border: 1px solid rgba(203,180,138,0.18);
      background: rgba(0,0,0,0.18);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.04);
    }
    .stat .label{
      color: rgba(239,230,214,0.62);
      font-size: 12px;
      margin-bottom: 6px;
    }
    .stat .value{
      font-size: 18px;
      font-weight: 850;
      letter-spacing: 0.2px;
      color: rgba(239,230,214,0.92);
    }

    .businessBody{
      padding: 0 14px 14px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    .panel{
      padding: 14px;
      border-radius: var(--radius-sm);
      border: 1px solid rgba(203,180,138,0.18);
      background: rgba(0,0,0,0.16);
    }
    .panel h3{
      margin:0 0 10px;
      font-family: "Georgia","Times New Roman",serif;
      color: var(--gold-3);
      letter-spacing: 0.2px;
      font-size: 20px;
    }
    .panelHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    .panelHeader h3{
      margin:0;
    }
    .createTaskBtn{
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(167,122,77,0.35);
      background: rgba(20,13,10,0.55);
      color: var(--gold-3);
      font-family: "Georgia","Times New Roman",serif;
      font-weight: 700;
      font-size: 12px;
      cursor: pointer;
      transition: 140ms ease;
    }
    .createTaskBtn:hover{
      background: rgba(92,64,40,0.5);
      border-color: rgba(225,194,138,0.55);
      transform: translateY(-1px);
    }
    .list{
      margin:0;
      padding-left: 18px;
      color: rgba(239,230,214,0.78);
      line-height: 1.6;
      font-size: 14px;
    }
    .kv{
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      padding: 10px 0;
      border-bottom: 1px solid rgba(203,180,138,0.14);
      color: rgba(239,230,214,0.78);
      font-size: 14px;
    }
    .kv:last-child{ border-bottom:0; }
    .kv b{ color: rgba(239,230,214,0.92); font-weight: 800; }

    @media (max-width: 920px){
      .card{ grid-template-columns: 220px 1fr; }
      .cardAction{ grid-column: 1 / -1; justify-content:flex-end; }
      .businessHero{ grid-template-columns: 1fr; }
      .heroImg img{ height: auto; }
      .heroStats{ grid-template-columns: 1fr; }
      .businessBody{ grid-template-columns: 1fr; }
    }
    @media (max-width: 620px){
      .topbar{
        flex-direction: column;
        align-items: stretch;
        padding: 0 14px 4px;
      }
      .left{
        width: 100%;
        min-width: 0;
        justify-content: center;
        padding-left: 0;
        margin-top: 0;
        position: relative;
      }
      .right{
        width: 100%;
        flex-direction: column;
        align-items: stretch;
      }
      .tabs{
        width:100%;
        justify-content:space-between;
        gap: 6px;
      }
      .tab{
        flex: 1 1 0;
        text-align: center;
        padding: 8px 6px;
        font-size: 12px;
        white-space: nowrap;
      }
      .profileMenu{
        position: absolute;
        top: 12px;
        right: 12px;
        z-index: 12;
      }
      .profile{ width:100%; justify-content:space-between; }
      .userAddr{ font-size: 0; }
      .userAddr::before{ content: "0x...9c"; font-size: 12px; margin-left: 10px; display: inline-block; }
      .userMeta{ max-width: 56px; }
      .userName{ font-size: 12px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
      .brand{
        min-width: unset;
        flex-direction: column;
        align-items: center;
        gap: 2px;
      }
      .brandTitle{
        position: static;
        margin: 0;
        text-align: center;
      }
      .card{ grid-template-columns: 1fr; }
      .thumb{ height: 190px; }
      .cardAction{ justify-content:flex-start; }
      .logo{ width: 64px; height: 64px; }
      .brandTitle h1{ font-size: 14px; }
    }
  </style>
</head>

<body>
  <!-- INTRO (kept the same) -->
  <div class="intro" id="intro" aria-hidden="true">
    <div class="introStage">
      <img id="introTree" class="introTree" src="images/spring.png" alt="" />
      <p id="introLine1" class="introLine1 jp">森へようこそでございます</p>
      <p id="introLine2" class="introLine2 jp">夏です。</p>
    </div>
  </div>

  <div class="wrap">
    <div class="headerStack">
      <div class="legalBanner">
        This application is a mock example. By using this app, you agree to the legal disclaimer
        <a href="https://github.com/0xAgro/Branchism/blob/main/README.md" target="_blank" rel="noopener noreferrer">here</a>.
        You can also <a href="https://github.com/0xAgro/Branchism?tab=readme-ov-file#support" target="_blank" rel="noopener noreferrer">support active research</a> (Ethereum accepted).
        <button class="legalDismiss" type="button" aria-label="Dismiss legal notice">&times;</button>
      </div>

      <div class="deployBanner" aria-label="Emergency Facet Deployment status">
        <div class="deployHead">
          <span class="deployTitle">Emergency Facet Deployment</span>
          <span class="deployState">Not Enacted</span>
        </div>
        <div class="deployTrack" aria-hidden="true">
          <span class="deployFill"></span>
          <span class="deployMark"></span>
          <span class="deployMarkLabel">70%</span>
        </div>
      </div>

      <header class="topbar">
        <div class="left">
          <div class="brand">
            <img class="logo" id="headerLogo" src="images/spring.png" alt="The Root logo" />
            <div class="brandTitle"><h1>The Root</h1></div>
          </div>
        </div>

        <div class="right">
          <nav class="tabs" aria-label="Primary">
            <a class="tab" href="explore.html">Explore</a>
            <a class="tab active" href="contract.html" aria-current="page">Contract Work</a>
            <a class="tab" href="clone.html">Clone</a>
            <a class="tab" href="manage.html">Manage</a>
          </nav>

        <div class="profileMenu">
          <button class="profileBtn" type="button" aria-label="Profile menu">
            <div class="userBadge">
                <div class="avatar" aria-hidden="true">
                  <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
                    <path d="M12 12.2a4 4 0 1 0-4-4 4 4 0 0 0 4 4Zm0 2.3c-3.2 0-6 1.6-6 3.8v1.2h12v-1.2c0-2.2-2.8-3.8-6-3.8Z"/>
                  </svg>
                </div>
                <div class="userMeta">
                  <div class="userName">中本 哲史</div>
                  <div class="userAddr">0x4f2a...9c1b</div>
              </div>
            </div>
          </button>
          <span class="profileNotify" aria-hidden="true">
            <svg viewBox="0 0 24 24"><path d="M12 22a2.8 2.8 0 0 0 2.7-2h-5.4A2.8 2.8 0 0 0 12 22Zm7-5H5c1-1 2-2.2 2-5v-1a5 5 0 1 1 10 0v1c0 2.8 1 4 2 5Z"/></svg>
          </span>
          <div class="profileNotifyTip">You have 4 branch requests</div>
          <div class="profilePanel" role="menu" aria-label="Wallet">
              <div class="profile">
                <div class="pill">Wallet <span class="value">Ξ2.1621</span></div>
                <div class="pill">Debt Allowance <span class="value">Ξ1</span></div>
              </div>
            </div>
          </div>
        </div>
      </header>
    </div>

    <!-- ===================== PAGE: YOUR AREA ===================== -->
    <main class="page" id="page-area" aria-label="Explore">
      <div class="mapPanel">
        <div class="mapHeader">
          <div style="display:flex; gap:10px; align-items:center;">
            <span class="badge">Tokyo</span>
            <span>Map view (OpenStreetMap embed)</span>
          </div>
          <span class="badge">Static</span>
        </div>

        <div id="map" role="img" aria-label="Tokyo Map"></div>
      </div>
    </main>

    <!-- ===================== PAGE: CLONE ===================== -->
    <main class="page" id="page-clone" aria-label="Clone">
      <div class="controls">
        <div class="search" role="search">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="2" opacity="0.85"/>
            <path d="M16.5 16.5 21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" opacity="0.85"/>
          </svg>
          <input id="search" type="search" placeholder="Search businesses…" autocomplete="off" />
        </div>
        <select id="sortClone" class="sortControl" aria-label="Sort clone businesses">
          <option value="distance_desc" selected>Sort: Farthest to closest branch</option>
          <option value="min_start_asc">Sort: Minimal starting cost</option>
          <option value="min_workers_asc">Sort: Minimal workers</option>
          <option value="avg_income_desc">Sort: Average yearly income</option>
        </select>
      </div>

      <section class="grid" id="cards">
        <article class="card" data-name="coffee shop cafe" data-distance-km="27" data-min-start="13.33" data-min-workers="3" data-avg-income="73.33">
          <div class="thumbWrap"><img class="thumb" src="images/cafe.png" alt="Coffee Shop" /></div>
          <div class="cardMain">
            <h3 class="title">Cafe Nakamoto</h3>
            <div class="rev">Ξ73.33 <span class="unit">/ year avg (all branches)</span></div>
            <div class="rowStats">
              <div><span class="k">Minimal starting capital</span><span class="v">Ξ13.33</span></div>
              <div><span class="k">Avg. operation</span><span class="v">Ξ20.00 / year</span></div>
              <div><span class="k">Worker range</span><span class="v">3-6</span></div>
              <div><span class="k">Closest Branch</span><span class="v">27 km</span></div>
            </div>
          </div>
          <div class="cardAction"><button class="viewBtn cloneBtnUnavailable" type="button" data-tip="Terminate your business before cloning">Clone Request</button></div>
        </article>

        <article class="card" data-name="pet grooming salon" data-distance-km="143" data-min-start="5.67" data-min-workers="2" data-avg-income="61.67">
          <div class="thumbWrap"><img class="thumb" src="images/Pet_store.png" alt="Pet Grooming" /></div>
          <div class="cardMain">
            <h3 class="title">Pet Grooming</h3>
            <div class="rev">Ξ61.67 <span class="unit">/ year avg (all branches)</span></div>
            <div class="rowStats">
              <div><span class="k">Minimal starting capital</span><span class="v">Ξ5.67</span></div>
              <div><span class="k">Avg. operation</span><span class="v">Ξ18.33 / year</span></div>
              <div><span class="k">Worker range</span><span class="v">2-5</span></div>
              <div><span class="k">Closest Branch</span><span class="v">143 km</span></div>
            </div>
          </div>
          <div class="cardAction"><button class="viewBtn cloneBtnUnavailable" type="button" data-tip="Terminate your business before cloning">Clone Request</button></div>
        </article>

        <article class="card" data-name="plant nursery garden" data-distance-km="312" data-min-start="8.33" data-min-workers="1" data-avg-income="68.33">
          <div class="thumbWrap"><img class="thumb" src="images/plant_nursery.png" alt="Plant Nursery" /></div>
          <div class="cardMain">
            <h3 class="title">Plant Nursery</h3>
            <div class="rev">Ξ68.33 <span class="unit">/ year avg (all branches)</span></div>
            <div class="rowStats">
              <div><span class="k">Minimal starting capital</span><span class="v">Ξ8.33</span></div>
              <div><span class="k">Avg. operation</span><span class="v">Ξ21.00 / year</span></div>
              <div><span class="k">Worker range</span><span class="v">1-4</span></div>
              <div><span class="k">Closest Branch</span><span class="v">312 km</span></div>
            </div>
          </div>
          <div class="cardAction"><button class="viewBtn cloneBtnUnavailable" type="button" data-tip="Terminate your business before cloning">Clone Request</button></div>
        </article>

        <article class="card" data-name="ice cream shop dessert" data-distance-km="8" data-min-start="8.33" data-min-workers="2" data-avg-income="73.33">
          <div class="thumbWrap"><img class="thumb" src="images/ice_cream.png" alt="Ice Cream Shop" /></div>
          <div class="cardMain">
            <h3 class="title">Ice Cream Shop</h3>
            <div class="rev">Ξ73.33 <span class="unit">/ year avg (all branches)</span></div>
            <div class="rowStats">
              <div><span class="k">Minimal starting capital</span><span class="v">Ξ8.33</span></div>
              <div><span class="k">Avg. operation</span><span class="v">Ξ21.00 / year</span></div>
              <div><span class="k">Worker range</span><span class="v">2-4</span></div>
              <div><span class="k">Closest Branch</span><span class="v">8 km</span></div>
            </div>
          </div>
          <div class="cardAction"><button class="viewBtn cloneBtnUnavailable" type="button" data-tip="Terminate your business before cloning">Clone Request</button></div>
        </article>
      </section>
    </main>

    <!-- ===================== PAGE: CONTRACT WORK ===================== -->
    <main class="page active" id="page-contract" aria-label="Contract Work">
      <div class="panel" style="margin-bottom:12px;">
        <div class="kv" style="border-bottom:0; padding:6px 0; display:flex; align-items:center; gap:8px;">
          <span style="display:inline-flex; width:18px; height:18px; border-radius:999px; align-items:center; justify-content:center; background:rgba(170,28,28,0.95); border:1px solid rgba(255,195,195,0.5); color:#fff3dc; flex:0 0 auto;">
            <svg viewBox="0 0 24 24" width="11" height="11" aria-hidden="true"><path fill="currentColor" d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2Zm0 15.4a1.2 1.2 0 1 1 1.2-1.2 1.2 1.2 0 0 1-1.2 1.2Zm1.1-4.3h-2.2V6.8h2.2Z"/></svg>
          </span>
          <span>This section is under development.</span>
          <b>Notice</b>
        </div>
      </div>
      <div class="controls">
        <div class="search" role="search">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="2" opacity="0.85"/>
            <path d="M16.5 16.5 21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" opacity="0.85"/>
          </svg>
          <input type="search" placeholder="Search contract services..." autocomplete="off" />
        </div>
        <select class="sortControl" aria-label="Sort contract services">
          <option selected>Sort: Highest yearly income</option>
          <option>Sort: Minimal starting cost</option>
          <option>Sort: Closest branch distance</option>
          <option>Sort: Minimal workers</option>
        </select>
      </div>

      <section class="grid">
        <article class="card">
          <div class="thumbWrap"><img class="thumb" src="images/police.png" alt="Policing service" /><span class="thumbMockTag">Not real. No real authority.</span></div>
          <div class="cardMain">
            <h3 class="title">Policing Unit</h3>
            <div class="rev">- <span class="unit">-</span></div>
            <div class="rowStats">
              <div><span class="k">Minimal starting capital</span><span class="v">-</span></div>
              <div><span class="k">Avg. operation</span><span class="v">-</span></div>
              <div><span class="k">Worker range</span><span class="v">-</span></div>
              <div><span class="k">Closest Branch</span><span class="v">-</span></div>
            </div>
          </div>
          <div class="cardAction"><button class="viewBtn" type="button">View</button></div>
        </article>

        <article class="card">
          <div class="thumbWrap"><img class="thumb" src="images/fire_fight.png" alt="Firefighting service" /><span class="thumbMockTag">Not real. No real authority.</span></div>
          <div class="cardMain">
            <h3 class="title">Firefighting Team</h3>
            <div class="rev">- <span class="unit">-</span></div>
            <div class="rowStats">
              <div><span class="k">Minimal starting capital</span><span class="v">-</span></div>
              <div><span class="k">Avg. operation</span><span class="v">-</span></div>
              <div><span class="k">Worker range</span><span class="v">-</span></div>
              <div><span class="k">Closest Branch</span><span class="v">-</span></div>
            </div>
          </div>
          <div class="cardAction"><button class="viewBtn" type="button">View</button></div>
        </article>

        <article class="card">
          <div class="thumbWrap"><img class="thumb" src="images/grid.png" alt="Grid work service" /><span class="thumbMockTag">Not real. No real authority.</span></div>
          <div class="cardMain">
            <h3 class="title">Grid Work Crew</h3>
            <div class="rev">- <span class="unit">-</span></div>
            <div class="rowStats">
              <div><span class="k">Minimal starting capital</span><span class="v">-</span></div>
              <div><span class="k">Avg. operation</span><span class="v">-</span></div>
              <div><span class="k">Worker range</span><span class="v">-</span></div>
              <div><span class="k">Closest Branch</span><span class="v">-</span></div>
            </div>
          </div>
          <div class="cardAction"><button class="viewBtn" type="button">View</button></div>
        </article>

        <article class="card">
          <div class="thumbWrap"><img class="thumb" src="images/emergency.png" alt="Emergency response service" /><span class="thumbMockTag">Not real. No real authority.</span></div>
          <div class="cardMain">
            <h3 class="title">Emergency Response</h3>
            <div class="rev">- <span class="unit">-</span></div>
            <div class="rowStats">
              <div><span class="k">Minimal starting capital</span><span class="v">-</span></div>
              <div><span class="k">Avg. operation</span><span class="v">-</span></div>
              <div><span class="k">Worker range</span><span class="v">-</span></div>
              <div><span class="k">Closest Branch</span><span class="v">-</span></div>
            </div>
          </div>
          <div class="cardAction"><button class="viewBtn" type="button">View</button></div>
        </article>
      </section>
    </main>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script>
    (function(){
      /* ===== Seasonal logic (system time) ===== */
      function getSeason(month){
        if (month >= 2 && month <= 4) return "spring";
        if (month >= 5 && month <= 7) return "summer";
        if (month >= 8 && month <= 10) return "fall";
        return "winter";
      }

      const seasonText = {
        spring: "春です。",
        summer: "夏です。",
        fall:   "秋です。",
        winter: "冬です。"
      };

      const seasonImage = {
        spring: "images/spring.png",
        summer: "images/summer.png",
        fall:   "images/fall.png",
        winter: "images/winter.png"
      };

      const season = getSeason(new Date().getMonth());

      document.getElementById('introLine2').textContent = seasonText[season] || "夏です。";
      document.getElementById('introTree').src = seasonImage[season] || "images/spring.png";
      document.getElementById("headerLogo").src = seasonImage[season] || "images/spring.png";

      const legalBanner = document.querySelector(".legalBanner");
      const legalDismissBtn = document.querySelector(".legalDismiss");
      const legalDismissKey = "root_legal_dismissed";
      try {
        if (localStorage.getItem(legalDismissKey) === "1" && legalBanner) {
          legalBanner.classList.add("isDismissed");
        }
      } catch (_) {}
      if (legalDismissBtn && legalBanner) {
        legalDismissBtn.addEventListener("click", () => {
          legalBanner.classList.add("isDismissed");
          try {
            localStorage.setItem(legalDismissKey, "1");
          } catch (_) {}
        });
      }

      /* ===== Intro sequence (0.75x, tree lingers longer) ===== */
      const intro = document.getElementById('intro');
      const line1 = document.getElementById('introLine1');
      const tree  = document.getElementById('introTree');
      const line2 = document.getElementById('introLine2');

      if (sessionStorage.getItem('root_intro_seen')) {
        intro.classList.add('hide');
      } else {
        sessionStorage.setItem('root_intro_seen','1');

        const t = { show1: 90, showTree: 675, show2: 1875, done: 2700 };

        setTimeout(() => line1.classList.add('show'), t.show1);
        setTimeout(() => tree.classList.add('showTree'), t.showTree);
        setTimeout(() => line2.classList.add('show'), t.show2);
        setTimeout(() => intro.classList.add('hide'), t.done);
      }

      /* ===== Tabs operational ===== */
      const tabs = Array.from(document.querySelectorAll('.tab[data-page]'));
      const pages = {
        area: document.getElementById('page-area'),
        clone: document.getElementById('page-clone'),
        manage: document.getElementById('page-manage')
      };

      function setActive(pageKey){
        tabs.forEach(t => t.classList.toggle('active', t.dataset.page === pageKey));
        Object.keys(pages).forEach(k => pages[k].classList.toggle('active', k === pageKey));
      }
      tabs.forEach(t => t.addEventListener('click', () => setActive(t.dataset.page)));

      /* ===== Search filter (Clone tab) ===== */
      const search = document.getElementById('search');
      const sortClone = document.getElementById('sortClone');
      const cardsContainer = document.getElementById('cards');
      const cards = Array.from(document.querySelectorAll('#cards .card'));

      function sortValue(card, key){
        if (key === 'distance_desc') return Number(card.getAttribute('data-distance-km') || 0);
        if (key === 'min_start_asc') return Number(card.getAttribute('data-min-start') || 0);
        if (key === 'min_workers_asc') return Number(card.getAttribute('data-min-workers') || 0);
        if (key === 'avg_income_desc') return Number(card.getAttribute('data-avg-income') || 0);
        return 0;
      }

      function renderCloneCards(){
        const query = (search && search.value ? search.value : '').trim().toLowerCase();
        const sortKey = sortClone ? sortClone.value : 'distance_desc';

        const visibleCards = cards.filter(card => {
          const name = (card.getAttribute('data-name') || '').toLowerCase();
          return !query || name.includes(query);
        });

        const sorted = visibleCards.slice().sort((a, b) => {
          const av = sortValue(a, sortKey);
          const bv = sortValue(b, sortKey);
          if (sortKey === 'min_start_asc' || sortKey === 'min_workers_asc') return av - bv;
          return bv - av;
        });

        cards.forEach(card => { card.style.display = 'none'; });
        sorted.forEach(card => {
          card.style.display = '';
          cardsContainer.appendChild(card);
        });
      }
      if (search) search.addEventListener('input', renderCloneCards);
      if (sortClone) sortClone.addEventListener('change', renderCloneCards);
      renderCloneCards();

      /* ===== Branch request acceptance (session only) ===== */
      const branchRequestsEl = document.querySelector('.branchRequests');
      if (branchRequestsEl) {
        const branchListEl = document.querySelector('.branchList');
        const requestListEl = branchRequestsEl.querySelector('.branchReqList');
        const requestCountEl = branchRequestsEl.querySelector('.branchReqCount');
        const notifyTipEl = document.querySelector('.profileNotifyTip');
        const notifyIconEl = document.querySelector('.profileNotify');

        const monthlyRevenueText = (document.querySelector('.heroStats .stat .value') || {}).textContent || '0';
        const monthlyRevenue = Number(monthlyRevenueText.replace(/[^0-9.]/g, '')) || 0;

        const ownerPctText = (document.querySelector('.teamMember.highlight .teamPct') || {}).textContent || '0';
        const ownerPct = Number(ownerPctText.replace(/[^0-9.]/g, '')) || 0;

        function formatEth(value){
          return '\u039e' + value.toFixed(4);
        }

        function renderRequestCount(count){
          requestCountEl.innerHTML = '<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 22a2.8 2.8 0 0 0 2.7-2h-5.4A2.8 2.8 0 0 0 12 22Zm7-5H5c1-1 2-2.2 2-5v-1a5 5 0 1 1 10 0v1c0 2.8 1 4 2 5Z"/></svg>' + count;
          requestCountEl.classList.toggle('isZero', count === 0);
          if (notifyIconEl) {
            notifyIconEl.style.display = count === 0 ? 'none' : '';
          }
          if (notifyTipEl) {
            notifyTipEl.style.display = count === 0 ? 'none' : '';
            notifyTipEl.textContent = 'You have ' + count + ' branch request' + (count === 1 ? '' : 's');
          }
        }

        function updateEmptyState(){
          const count = requestListEl.querySelectorAll('.branchReqItem').length;
          let emptyNode = requestListEl.querySelector('.branchReqEmpty');
          if (count === 0) {
            if (!emptyNode) {
              emptyNode = document.createElement('div');
              emptyNode.className = 'branchReqItem branchReqEmpty';
              emptyNode.textContent = 'No pending requests';
              requestListEl.appendChild(emptyNode);
            }
          } else if (emptyNode) {
            emptyNode.remove();
          }
          renderRequestCount(count);
        }

        function addBranch(addr, pctText){
          const newItem = document.createElement('div');
          newItem.className = 'branchItem';
          newItem.innerHTML =
            '<span class="branchLeft">' +
              '<span class="storeIcon" aria-hidden="true">' +
                '<svg viewBox="0 0 24 24"><path d="M4 7h16l-1.5 4H5.5L4 7Zm1 6h14v6H5v-6Zm4 1v4h2v-4H9Zm4 0v4h2v-4h-2Z"/></svg>' +
              '</span>' +
              '<span class="branchAddr">' + addr + '</span>' +
            '</span>' +
            '<span class="branchRoyalty">' + pctText + ' royalty</span>';
          branchListEl.appendChild(newItem);
        }

        requestListEl.querySelectorAll('.branchAcceptBtn').forEach((btn) => {
          btn.disabled = false;
          btn.addEventListener('click', () => {
            const item = btn.closest('.branchReqItem');
            if (!item) return;

            const addrNode = item.children[0];
            const pctNode = item.querySelector('.branchReqPct');
            if (!addrNode || !pctNode) return;

            const addr = addrNode.textContent.trim();
            const pctText = pctNode.textContent.trim();
            const pct = Number(pctText.replace(/[^0-9.]/g, '')) || 0;

            const activeCount = Math.max(1, branchListEl.querySelectorAll('.branchItem').length);
            const avgBranchRevenue = monthlyRevenue / activeCount;
            const personalIncrease = avgBranchRevenue * (pct / 100) * (ownerPct / 100);

            const confirmed = window.confirm(
              'Accept branch request from ' + addr + ' at ' + pctText + ' royalty?\n\n' +
              'Estimated personal income increase: ' + formatEth(personalIncrease) + ' / month'
            );
            if (!confirmed) return;

            addBranch(addr, pctText);
            item.remove();
            updateEmptyState();
          });
        });

        updateEmptyState();
      }

      /* ===== Map (Leaflet) ===== */
      const map = L.map("map", {
        zoomControl: true,
        attributionControl: true
      }).setView([35.640126, 139.921591], 18);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 20,
        attribution: "&copy; OpenStreetMap contributors"
      }).addTo(map);

      L.marker([35.640126, 139.921591]).addTo(map);

    })();
  </script>
</body>
</html>
